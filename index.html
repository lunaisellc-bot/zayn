<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZAYN | SYSTEM DIAGNOSTIC</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #111; color: #fff; font-family: monospace; padding: 20px; }
        .log-box { background: #222; border: 1px solid #444; padding: 15px; margin-bottom: 10px; border-radius: 5px; font-size: 12px; white-space: pre-wrap; word-wrap: break-word; }
        .success { border-color: #2ecc71; color: #2ecc71; }
        .error { border-color: #e74c3c; color: #e74c3c; background: #2c0b0b; }
        .info { border-color: #3498db; color: #3498db; }
        img { width: 100px; height: 150px; object-fit: cover; border: 1px solid #555; margin: 5px; }
        .grid-preview { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px; }
    </style>
</head>
<body>

    <h1 class="text-xl mb-4 font-bold border-b border-gray-700 pb-2">ZAYN DIAGNOSTIC TOOL v1.0</h1>
    <p class="text-xs text-gray-500 mb-6">Bu sayfa hatayı bulmak için tasarlanmıştır. Lütfen ekran görüntüsü alın.</p>

    <div id="console-output"></div>

    <div id="preview-area" class="grid-preview"></div>

    <script>
        const output = document.getElementById('console-output');
        const preview = document.getElementById('preview-area');

        // Ekrana Log Yazdırma Fonksiyonu
        function printLog(msg, type = 'info') {
            const div = document.createElement('div');
            div.className = `log-box ${type}`;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${msg}`;
            output.appendChild(div);
        }

        // --- ADIM 1: YOL KONTROLÜ ---
        // GitHub Pages'de klasör yapısını anlamak için
        const possiblePaths = [
            "assets/data/products.json",
            "./assets/data/products.json",
            "/assets/data/products.json",
            "https://zaynbrand.com/assets/data/products.json" 
        ];

        async function runDiagnostics() {
            printLog("Sistem başlatılıyor... Tarayıcı: " + navigator.userAgent);
            
            let success = false;

            for (let path of possiblePaths) {
                printLog(`Deneniyor: ${path}...`, 'info');
                
                try {
                    // Cache'i kırmak için timestamp ekle
                    const urlWithCache = path + "?t=" + new Date().getTime();
                    
                    const response = await fetch(urlWithCache);
                    printLog(`HTTP Yanıt Kodu: ${response.status} (${response.statusText})`, response.ok ? 'success' : 'error');

                    if (response.ok) {
                        // Dosya bulundu, şimdi içeriği kontrol et
                        const textData = await response.text();
                        
                        // İçerik HTML mi JSON mı? (Bazen 404 sayfası HTML döner)
                        if (textData.trim().startsWith("<")) {
                            printLog("HATA: JSON beklenirken HTML geldi. Dosya yolunda 404 sayfası dönüyor olabilir.", 'error');
                            printLog("Gelen Veri Başı: " + textData.substring(0, 100), 'error');
                            continue; // Diğer yolu dene
                        }

                        // JSON parse etmeyi dene
                        try {
                            const jsonData = JSON.parse(textData);
                            printLog(`BAŞARILI! ${jsonData.length} adet ürün bulundu.`, 'success');
                            printLog("Örnek Ürün: " + jsonData[0].title, 'success');
                            
                            // Ürünleri ekrana bas
                            renderPreview(jsonData);
                            success = true;
                            break; // Döngüyü kır, bulduk!
                        } catch (e) {
                            printLog("JSON PARSE HATASI: Dosya indirildi ama bozuk. " + e.message, 'error');
                        }
                    } else {
                        printLog("Bu yoldan dosya çekilemedi.", 'error');
                    }

                } catch (err) {
                    printLog(`AĞ HATASI (Fetch Failed): ${err.message}`, 'error');
                }
            }

            if (!success) {
                printLog("SONUÇ: Hiçbir yoldan veri alınamadı. Lütfen repo klasör yapısını kontrol edin.", 'error');
            }
        }

        function renderPreview(data) {
            preview.innerHTML = "";
            data.forEach(item => {
                const img = item.image1 || "";
                preview.innerHTML += `
                    <div style="width:120px; background:#222; padding:5px;">
                        <img src="${img}" onerror="this.src='https://via.placeholder.com/100'">
                        <div style="font-size:10px; margin-top:5px;">${item.price} ${item.currency}</div>
                    </div>
                `;
            });
            printLog("Görseller yükleniyor...", 'info');
        }

        // Başlat
        runDiagnostics();

    </script>
</body>
</html>
