      - name: Fetch active listings
        env:
          SHOP_ID: ${{ secrets.ETSY_SHOP_ID }}
          ACCESS_TOKEN: ${{ steps.token.outputs.access_token }}
        run: |
          set -euo pipefail

          # isteği yap – TEK DOĞRU HEADER bu
          curl -sS -w "\n%{http_code}\n" \
            -H "Authorization: Bearer ${ACCESS_TOKEN}" \
            "https://api.etsy.com/v3/application/shops/${SHOP_ID}/listings/active?limit=100" \
          | tee /tmp/resp \
          | tail -n1 > /tmp/code

          code=$(cat /tmp/code)
          body=$(sed '$d' /tmp/resp)

          echo "$body" > etsy.json
          echo "HTTP $code"

          test "$code" = "200" || (echo "Etsy API error (HTTP $code): $body" && exit 1)
