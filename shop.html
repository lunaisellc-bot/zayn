<!DOCTYPE html>
<html lang="tr" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ZAYN | Koleksiyon</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400;1,600&family=Monsieur+La+Doulaise&family=Inter:wght@300;400&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.tailwindcss.com"></script>
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            serif: ['Cormorant Garamond', 'serif'],
            display: ['Cinzel Decorative', 'serif'],
            script: ['Monsieur La Doulaise', 'cursive'],
            sans: ['Inter', 'sans-serif']
          },
          colors: {
            'ink': '#2C1A1D',
            'paper': '#F0E6D2',
            'rose': '#B06E6E',
            'gold': '#C5A065'
          }
        }
      }
    }
  </script>

  <style>
    body {
      background-color: #F0E6D2;
      background-image: url('https://www.transparenttextures.com/patterns/dust.png'), url('https://www.transparenttextures.com/patterns/aged-paper.png');
      background-blend-mode: multiply;
      color: #2C1A1D;
    }
    
    .polaroid {
      background: #fff;
      padding: 10px 10px 25px 10px;
      box-shadow: 2px 2px 10px rgba(0,0,0,0.1);
      transition: all 0.4s;
    }
    .polaroid:hover {
      transform: translateY(-5px) rotate(1deg);
      box-shadow: 5px 15px 30px rgba(0,0,0,0.15);
      z-index: 10;
    }
    
    .vintage-input {
      background: rgba(255,255,255,0.4);
      border: none;
      border-bottom: 2px solid #2C1A1D;
      font-family: 'Cormorant Garamond', serif;
      font-style: italic;
      color: #2C1A1D;
    }
    .vintage-input:focus { outline: none; background: rgba(255,255,255,0.7); border-color: #B06E6E; }

    /* DİL BUTONLARI */
    .lang-btn { cursor: pointer; opacity: 0.5; font-weight: bold; }
    .lang-btn.active { opacity: 1; color: #B06E6E; text-decoration: underline; }
    
    .reveal { opacity: 0; transform: translateY(20px); transition: 0.8s; }
    .reveal.active { opacity: 1; transform: translateY(0); }
  </style>
</head>

<body class="flex flex-col min-h-screen">

  <img src="https://img.freepik.com/free-vector/hand-drawn-vintage-flowers_23-2148115469.jpg" class="fixed -top-20 -right-20 w-80 opacity-10 mix-blend-multiply pointer-events-none rotate-180 z-0">

  <header class="sticky top-0 z-50 bg-[#F0E6D2]/95 backdrop-blur-md border-b border-ink/10 py-4">
    <div class="max-w-7xl mx-auto px-6 flex items-center justify-between">
      <a href="index.html" class="flex flex-col items-center leading-none group">
        <span class="font-display text-xl text-ink group-hover:text-rose transition">Zayn</span>
      </a>
      
      <div class="flex gap-6 items-center">
        <div class="text-[10px] font-bold flex gap-2 border-r border-ink/20 pr-4">
          <button onclick="setLang('tr')" class="lang-btn active" id="btn-tr">TR</button>
          <button onclick="setLang('en')" class="lang-btn" id="btn-en">EN</button>
        </div>

        <a href="index.html" class="font-display text-xs tracking-widest text-ink hover:text-rose transition" data-i18n="nav_home">ANA SAYFA</a>
        <a id="shopEtsyLinkTop" href="#" target="_blank" class="bg-ink text-paper px-4 py-2 rounded-sm text-[10px] font-display tracking-widest hover:bg-rose transition" data-i18n="nav_cta">
          ETSY SATIN AL
        </a>
      </div>
    </div>
  </header>

  <main class="relative z-10 flex-grow py-12 px-6">
    <div class="max-w-7xl mx-auto">
      
      <div class="flex flex-col md:flex-row md:items-end justify-between gap-8 mb-16 reveal active border-b-2 border-ink/10 pb-8 border-dotted">
        <div>
          <h1 class="font-display text-5xl text-ink mb-1" data-i18n="shop_title">Koleksiyon</h1>
          <p class="font-script text-3xl text-rose" data-i18n="shop_sub">"Her parça bir hikaye..."</p>
        </div>
        
        <div class="flex flex-wrap gap-6 items-center">
           <div class="relative">
             <input id="searchInput" type="text" placeholder="Ara..." class="vintage-input py-2 px-2 text-xl w-48 placeholder-ink/30">
             <i class="fa-solid fa-search absolute right-2 top-3 text-ink/30"></i>
           </div>
           <select id="categorySelect" class="bg-transparent font-display text-xs tracking-widest border-b-2 border-ink cursor-pointer focus:outline-none">
             <option value="__all__" data-i18n="cat_all">TÜM PARÇALAR</option>
           </select>
        </div>
      </div>

      <div id="productsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8 pb-20">
         </div>

      <div id="emptyState" class="hidden py-20 text-center">
        <p class="font-script text-4xl text-ink/30" data-i18n="empty_msg">"Sandıkta böyle bir parça bulamadık..."</p>
      </div>

    </div>
  </main>

  <script>
    // --- ÇOKLU DİL ---
    const translations = {
      tr: {
        nav_home: "ANA SAYFA", nav_cta: "ETSY SATIN AL",
        shop_title: "Koleksiyon", shop_sub: "\"Her parça bir hikaye...\"",
        cat_all: "TÜM PARÇALAR", empty_msg: "\"Sandıkta böyle bir parça bulamadık...\"",
        sold_out: "TÜKENDİ"
      },
      en: {
        nav_home: "HOME", nav_cta: "BUY ON ETSY",
        shop_title: "Collection", shop_sub: "\"Every piece tells a story...\"",
        cat_all: "ALL ITEMS", empty_msg: "\"We couldn't find such a piece in the chest...\"",
        sold_out: "SOLD OUT"
      }
    };

    let currentLang = 'tr';
    let allProducts = [];

    function setLang(lang) {
      currentLang = lang;
      document.getElementById('btn-tr').classList.toggle('active', lang === 'tr');
      document.getElementById('btn-en').classList.toggle('active', lang === 'en');
      
      // Statik metinleri değiştir
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if(translations[lang][key]) el.innerHTML = translations[lang][key];
      });

      // Grid'i yeniden çiz (Fiyat formatı ve Tükendi yazısı için)
      if(allProducts.length > 0) renderGrid(allProducts);
    }

    // --- APP LOGIC ---
    const DATA_PRODUCTS = "assets/data/products.json";
    const ETSY_FALLBACK = "https://www.etsy.com/shop/ZaynCollective"; 

    // Helper
    const formatPrice = (amount, currency) => {
      const n = Number(amount);
      if(!Number.isFinite(n)) return "";
      const norm = n > 999 ? n/100 : n;
      return new Intl.NumberFormat(currentLang === 'tr' ? 'tr-TR' : 'en-US', { style: 'currency', currency: currency || 'USD' }).format(norm);
    };

    async function loadShop() {
      try {
        const res = await fetch(DATA_PRODUCTS);
        allProducts = await res.json();
      } catch(e) { console.log('Err'); }

      // Etsy Link
      const url = (allProducts[0] && allProducts[0].url) ? allProducts[0].url.split("/listing/")[0] : ETSY_FALLBACK;
      const topLink = document.getElementById('shopEtsyLinkTop');
      if(topLink) topLink.href = url;

      // Populate Categories & Render
      populateCats();
      renderGrid(allProducts);
    }

    function populateCats() {
      const select = document.getElementById('categorySelect');
      const cats = [...new Set(allProducts.map(p => p.category || 'Koleksiyon'))].sort();
      cats.forEach(c => {
        const opt = document.createElement('option');
        opt.value = c; opt.innerText = c.toUpperCase();
        select.appendChild(opt);
      });
    }

    function renderGrid(products) {
      const grid = document.getElementById('productsGrid');
      const search = document.getElementById('searchInput');
      const catSelect = document.getElementById('categorySelect');
      const empty = document.getElementById('emptyState');
      const soldText = translations[currentLang].sold_out;

      function draw() {
        const q = search.value.toLowerCase();
        const c = catSelect.value;
        
        const filtered = products.filter(p => {
          const matchText = ((p.title||'') + ' ' + (p.tags||[]).join(' ')).toLowerCase().includes(q);
          const matchCat = c === '__all__' || p.category === c;
          return matchText && matchCat;
        });

        if(filtered.length === 0) {
          grid.innerHTML = '';
          empty.classList.remove('hidden');
        } else {
          empty.classList.add('hidden');
          grid.innerHTML = filtered.map(p => `
            <a href="${p.url || '#'}" target="_blank" class="polaroid block group reveal">
              <div class="aspect-[3/4] overflow-hidden mb-3 relative bg-gray-100 grayscale-[20%] group-hover:grayscale-0 transition duration-500">
                <img src="${p.image1}" class="w-full h-full object-cover" 
                     onmouseenter="this.src='${p.image2 || p.image1}'" 
                     onmouseleave="this.src='${p.image1}'">
                ${(p.state && p.state.toLowerCase() !== 'active') ? `<div class="absolute bottom-2 right-2 bg-ink text-paper text-[9px] font-bold px-2 py-1 uppercase tracking-widest">${soldText}</div>` : ''}
              </div>
              <div class="text-center">
                <h3 class="font-serif text-lg italic text-ink leading-tight mb-2 truncate px-2">${p.title}</h3>
                <div class="text-rose font-display text-xs border-t border-ink/10 pt-2 inline-block px-4">${formatPrice(p.price, p.currency)}</div>
              </div>
            </a>
          `).join('');
          
          // Animasyonu tetikle
          const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => { if(entry.isIntersecting) entry.target.classList.add('active'); });
          });
          document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
        }
      }

      // Event Listeners (Sadece ilk seferde ekle)
      if(!search.dataset.bound) {
        search.addEventListener('input', draw);
        catSelect.addEventListener('change', draw);
        search.dataset.bound = true;
      }
      draw();
    }

    document.addEventListener('DOMContentLoaded', loadShop);
  </script>
</body>
</html>
